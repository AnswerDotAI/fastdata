[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "fastdata",
    "section": "",
    "text": "fastdata is a minimal library for generating synthetic data for training deep learning models. For example, below is how you can generate a dataset to train a language model to translate from English to Spanish.\nFirst you need to define the structure of the data you want to generate. claudette, which is the library that fastdata uses to generate data, requires you to define the schema of the data you want to generate.\nfrom fastcore.utils import *\nclass Translation():\n    \"Translation from an English phrase to a Spanish phrase\"\n    def __init__(self, english: str, spanish: str): store_attr()\n    def __repr__(self): return f\"{self.english} ➡ *{self.spanish}*\"\n\nTranslation(\"Hello, how are you today?\", \"Hola, ¿cómo estás hoy?\")\n\nHello, how are you today? ➡ *Hola, ¿cómo estás hoy?*\nNext, you need to define the prompt that will be used to generate the data and any inputs you want to pass to the prompt.\nprompt_template = \"\"\"\\\nGenerate English and Spanish translations on the following topic:\n&lt;topic&gt;{topic}&lt;/topic&gt;\n\"\"\"\n\ninputs = [{\"topic\": \"Otters are cute\"}, {\"topic\": \"I love programming\"}]\nFinally, we can generate some data with fastdata.\nfrom fastdata.core import FastData\nfast_data = FastData(model=\"claude-3-haiku-20240307\")\ntranslations = fast_data.generate(\n    prompt_template=prompt_template,\n    inputs=inputs,\n    schema=Translation,\n)\n\n100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:01&lt;00:00,  1.57it/s]\nfrom IPython.display import Markdown\nMarkdown(\"\\n\".join(f'- {t}' for t in translations))\n\n\nI love programming ➡ Me encanta la programación\nOtters are cute ➡ Las nutrias son lindas",
    "crumbs": [
      "fastdata"
    ]
  },
  {
    "objectID": "index.html#developer-guide",
    "href": "index.html#developer-guide",
    "title": "fastdata",
    "section": "Developer Guide",
    "text": "Developer Guide\nIf you are new to using nbdev here are some useful pointers to get you started.\n\nInstall fastdata in Development mode\n# make sure fastdata package is installed in development mode\n$ pip install -e .\n\n# make changes under nbs/ directory\n# ...\n\n# compile to have changes apply to fastdata\n$ nbdev_prepare",
    "crumbs": [
      "fastdata"
    ]
  },
  {
    "objectID": "core.html",
    "href": "core.html",
    "title": "core",
    "section": "",
    "text": "source\n\nFastData\n\n FastData (model:str='claude-3-haiku-20240307', calls:int=100,\n           period:int=60)\n\nInitialize self. See help(type(self)) for accurate signature.\n\nclass Translation():\n    \"Translation from an English phrase to a Spanish phrase\"\n    def __init__(self, english: str, spanish: str): store_attr()\n    def __repr__(self): return f\"{self.english} ➡ *{self.spanish}*\"\n\nTranslation(\"Hello, how are you today?\", \"Hola, ¿cómo estás hoy?\")\n\nHello, how are you today? ➡ *Hola, ¿cómo estás hoy?*\n\n\n\nexamples = [\n    Translation(\n        english=\"Hello, my name is Nathan. I am a research scientist at an AI startup.\",\n        spanish=\"Hola, me llamo Nathan. Soy ciencia investigador en un startup de IA.\"),\n    Translation(\n        english=\"How much wood could a woodchuck chuck if a woodchuck could chuck wood?\",\n        spanish=\"¿Cuánta madera podría arrojar una marmota si una marmota pudiera arrojar madera?\"),\n    Translation(\n        english=\"Thomas Cranmer (2 July 1489 - 21 March 1556) was a leader of the English Reformation and Archbishop of Canterbury during the reigns of Henry VIII, Edward VI and, for a short time, Mary I. He helped build the case for the annulment of Henry's marriage to Catherine of Aragon, which was one of the causes of the separation of the English Church from union with the Holy See.\",\n        spanish=\"Thomas Cranmer (2 de julio de 1489 - 21 de marzo de 1556) fue un líder de la Reforma inglesa y arzobispo de Canterbury durante los reinados de Henry VIII, Edward VI y, por un corto tiempo, María I. Ayudó a construir el caso para la anulación de El matrimonio de Henry con Catalina de Aragón, que fue una de las causas de la separación de la Iglesia inglesa de la unión con la Santa Sede.\"\n    ),\n]\nshow(examples)\n\n\nHello, my name is Nathan. I am a research scientist at an AI startup. ➡ Hola, me llamo Nathan. Soy ciencia investigador en un startup de IA.\nHow much wood could a woodchuck chuck if a woodchuck could chuck wood? ➡ ¿Cuánta madera podría arrojar una marmota si una marmota pudiera arrojar madera?\nThomas Cranmer (2 July 1489 - 21 March 1556) was a leader of the English Reformation and Archbishop of Canterbury during the reigns of Henry VIII, Edward VI and, for a short time, Mary I. He helped build the case for the annulment of Henry’s marriage to Catherine of Aragon, which was one of the causes of the separation of the English Church from union with the Holy See. ➡ Thomas Cranmer (2 de julio de 1489 - 21 de marzo de 1556) fue un líder de la Reforma inglesa y arzobispo de Canterbury durante los reinados de Henry VIII, Edward VI y, por un corto tiempo, María I. Ayudó a construir el caso para la anulación de El matrimonio de Henry con Catalina de Aragón, que fue una de las causas de la separación de la Iglesia inglesa de la unión con la Santa Sede.\n\n\n\n\nfrom datasets import load_dataset\n\n/home/algal/miniconda/envs/jup3/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n  from .autonotebook import tqdm as notebook_tqdm\n\n\n\n# Load personas\npersonas = load_dataset(\"proj-persona/PersonaHub\", \"persona\", split='train').select(range(3))['persona']\nshow(personas)\n\nGenerating train split: 100%|█| 200000/200000 [00:00&lt;00:00, 3852934.04 examples/\n\n\n\nA Political Analyst specialized in El Salvador’s political landscape.\nA legal advisor who understands the legal implications of incomplete or inaccurate project documentation\nA maternal health advocate focused on raising awareness about postpartum complications.\n\n\n\n\nsp = \"You will help generate synthetic data of English and Spanish phrases.\"\nprompt_template = \"\"\"\\\n&lt;examples&gt;\n{examples}\n&lt;/examples&gt;\n\nCreate an English and Spanish translation pair that is similar to the examples and would be appropriate for the following persona:\n&lt;persona&gt;{persona}&lt;/persona&gt;\n\"\"\"\n\nLet’s see what the prompt looks like in action:\n\nexamples_md = to_md(examples)\nprompt = prompt_template.format(examples=examples_md, persona=personas[0])\nprint(prompt)\n\n&lt;examples&gt;\n- Hello, my name is Nathan. I am a research scientist at an AI startup. ➡ *Hola, me llamo Nathan. Soy ciencia investigador en un startup de IA.*\n- How much wood could a woodchuck chuck if a woodchuck could chuck wood? ➡ *¿Cuánta madera podría arrojar una marmota si una marmota pudiera arrojar madera?*\n- Thomas Cranmer (2 July 1489 - 21 March 1556) was a leader of the English Reformation and Archbishop of Canterbury during the reigns of Henry VIII, Edward VI and, for a short time, Mary I. He helped build the case for the annulment of Henry's marriage to Catherine of Aragon, which was one of the causes of the separation of the English Church from union with the Holy See. ➡ *Thomas Cranmer (2 de julio de 1489 - 21 de marzo de 1556) fue un líder de la Reforma inglesa y arzobispo de Canterbury durante los reinados de Henry VIII, Edward VI y, por un corto tiempo, María I. Ayudó a construir el caso para la anulación de El matrimonio de Henry con Catalina de Aragón, que fue una de las causas de la separación de la Iglesia inglesa de la unión con la Santa Sede.*\n&lt;/examples&gt;\n\nCreate an English and Spanish translation pair that is similar to the examples and would be appropriate for the following persona:\n&lt;persona&gt;A Political Analyst specialized in El Salvador's political landscape.&lt;/persona&gt;\n\n\n\n\n# Generate translations\nfast_data = FastData(model=\"claude-3-haiku-20240307\")\ntranslations = fast_data.generate(\n    prompt_template=prompt_template,\n    inputs=[{\"persona\": persona, \"examples\": examples} for persona in personas],\n    schema=Translation,\n    sp=sp\n)\n\n100%|█████████████████████████████████████████████| 3/3 [00:01&lt;00:00,  1.64it/s]\n\n\n\nshow(translations)\n\n\nThe political situation in El Salvador continues to be complex, with ongoing tensions between the ruling party and opposition groups. President Nayib Bukele has consolidated significant power, raising concerns about the state of democracy in the country. ➡ La situación política en El Salvador sigue siendo compleja, con tensiones persistentes entre el partido gobernante y los grupos de oposición. El presidente Nayib Bukele ha consolidado un poder significativo, lo que genera preocupaciones sobre el estado de la democracia en el país.\nThorough documentation is critical for any legal proceedings. Incomplete or inaccurate records can have serious consequences. ➡ La documentación exhaustiva es fundamental para cualquier proceso legal. Los registros incompletos o inexactos pueden tener consecuencias graves.\nPostpartum complications can be life-threatening, but with proper care and support, new mothers can recover and thrive. Let’s work together to ensure all women have access to the resources they need during this crucial time. ➡ Las complicaciones posparto pueden poner en riesgo la vida, pero con la atención y el apoyo adecuados, las nuevas madres pueden recuperarse y prosperar. Trabajemos juntos para garantizar que todas las mujeres tengan acceso a los recursos que necesitan durante este momento crucial.\n\n\n\n\n# Generate translations and push results to Hugging Face Hub as a dataset\n# Be sure to have the HF_TOKEN environment variable set to your Hugging Face API token\nfast_data = FastData(model=\"claude-3-haiku-20240307\")\nrepo_id, translations = fast_data.generate_to_hf(\n    prompt_template=prompt_template,\n    inputs=[{\"persona\": persona, \"examples\": examples} for persona in personas],\n    schema=Translation,\n    sp=sp,\n    repo_id=f\"personas-translation-{uuid4()}\",\n    max_items_per_file=2, # It will create a local file each 2 translations  \n)\nassert len(translations) == len(personas)\n\nnew_dataset = load_dataset(repo_id)\nassert len(translations) == len(personas)\n\n\nclass TranslationCritique():\n    \"A critique of the translation.\"\n    def __init__(self, critique: str, score: int): store_attr()\n    def __repr__(self): return f\"\\t- **Critique:** {self.critique}\\n\\t- **Score:** {self.score}\"\n\n\nsp = \"You will help critique synthetic data of English and Spanish phrases.\"\ncritique_template = \"\"\"\\\nBelow is an extract of a translation. Evaluate its quality as a senior translator would, considering its suitability for professional use. Use the additive 5-point scoring system described below. Points are accumulated based on the satisfaction of each criterion:\n\n- Add 1 point if the translation conveys the basic meaning of the source text, even if it includes some minor errors or awkward phrasing.\n- Add another point if the translation is generally accurate but lacks refinement in style or fails to capture some nuances of the original. It might use inconsistent terminology or have occasional lapses in register.\n- Award a third point if the translation is appropriate for professional use and accurately conveys key concepts of the source text. It demonstrates good understanding of both languages, though it may not be flawless or could include some slight inconsistencies. It resembles the work of a competent translator but may have room for improvement in fluency or precision.\n- Grant a fourth point if the translation is highly accurate and reads naturally in the target language, exhibiting a consistent and appropriate style. It could be similar to the work of an experienced translator, offering faithful rendering of content and tone, with minimal errors, and effectively handling complex concepts or cultural references. The result is coherent, well-expressed, and valuable for its intended purpose.\n- Bestow a fifth point if the translation is outstanding, demonstrating mastery of both source and target languages. It captures subtle nuances, maintains the author's voice and intent, and reads as if it were originally written in the target language. The translator has made excellent choices in dealing with challenging elements like wordplay, idiomatic expressions, or culture-specific content.\n\n&lt;translation&gt;{translation}&lt;/translation&gt;\n\nAfter examining the translation:\n\n- Briefly justify your total score, up to 100 words.\n- Conclude with the score of the translation.\n\"\"\"\n\n\nfast_data = FastData(model=\"claude-3-5-sonnet-20240620\")\ncritiques = fast_data.generate(\n    prompt_template=critique_template,\n    inputs=[{\"translation\": f\"{t.english} -&gt; {t.spanish}\"} for t in translations],\n    schema=TranslationCritique,\n    sp=sp\n)\n\n100%|█████████████████████████████████████████████| 3/3 [00:03&lt;00:00,  1.27s/it]\n\n\n\nshow(f'{t}\\n\\n{c}' for t, c in zip(translations, critiques))\n\n\nThe political situation in El Salvador continues to be complex, with ongoing tensions between the ruling party and opposition groups. President Nayib Bukele has consolidated significant power, raising concerns about the state of democracy in the country. ➡ La situación política en El Salvador sigue siendo compleja, con tensiones persistentes entre el partido gobernante y los grupos de oposición. El presidente Nayib Bukele ha consolidado un poder significativo, lo que genera preocupaciones sobre el estado de la democracia en el país.\n\nCritique: The translation accurately conveys the meaning of the source text, capturing the complexity of El Salvador’s political situation. It effectively translates key terms and maintains the tone of the original. The translator demonstrates a strong grasp of both languages, rendering the content naturally in Spanish. The phrasing is appropriate and flows well, preserving the nuances of the English version. There are no noticeable errors or awkward constructions. The translation skillfully handles the political terminology and concepts, making it suitable for professional use. It reads as if it were originally written in Spanish, indicating the translator’s expertise.\nScore: 5\n\nThorough documentation is critical for any legal proceedings. Incomplete or inaccurate records can have serious consequences. ➡ La documentación exhaustiva es fundamental para cualquier proceso legal. Los registros incompletos o inexactos pueden tener consecuencias graves.\n\nCritique: The translation accurately conveys the main message of the source text, maintaining both the meaning and tone. It effectively captures the importance of thorough documentation in legal proceedings and the potential consequences of incomplete or inaccurate records. The translator has chosen appropriate Spanish equivalents for key terms, such as “exhaustiva” for “thorough” and “proceso legal” for “legal proceedings”. The sentence structure is natural in Spanish, and the translation maintains the formal register suitable for legal contexts. There are no errors in grammar or vocabulary. The translation demonstrates a high level of competence, accurately conveying complex concepts while reading naturally in the target language. It could be considered the work of an experienced translator.\nScore: 4\n\nPostpartum complications can be life-threatening, but with proper care and support, new mothers can recover and thrive. Let’s work together to ensure all women have access to the resources they need during this crucial time. ➡ Las complicaciones posparto pueden poner en riesgo la vida, pero con la atención y el apoyo adecuados, las nuevas madres pueden recuperarse y prosperar. Trabajemos juntos para garantizar que todas las mujeres tengan acceso a los recursos que necesitan durante este momento crucial.\n\nCritique: The translation accurately conveys the meaning of the original text, maintaining both the informative and encouraging tone. It correctly translates key terms like “postpartum complications” and “life-threatening.” The Spanish version flows naturally and captures the nuances of the original, including the call to action. The translator has made excellent choices in vocabulary and structure, resulting in a text that reads as if it were originally written in Spanish. The translation demonstrates a high level of proficiency in both languages and would be suitable for professional use in healthcare communications.\nScore: 5\n\n\n\n\n\n\nTest that generate outputs align with inputs\nLet’s verify that the FastData.generate returns results in the same order as the inputs it was passed.\nTo show this, we will define a new prompt template, where the model is asked only to echo a piece of data from the input. Then we will verify that the values in the inputs matches the values in the outputs, in order and in value.\n\nsp=\"You will help with accurate and faithful data processing.\"\nprompt_template = \"\"\"\\\nBelow you find an item of data, a datum, which is an alphanumeric string:\n\n&lt;datum&gt;{datum}&lt;/datum&gt;\n\nAfter reviewing this datum, please echo is back exactly, without any preamble:\n\"\"\"\n\n\nclass Datum:\n    \"A data value\"\n    def __init__(self, datum: str): store_attr()\n    def __repr__(self): return f\"{self.datum}\"\n\nFirst we’ll test that the prompt and schema class work as execpted.\n\nprint(prompt_template.format(**dict(datum=str(uuid4()))))\n\nBelow you find an item of data, a datum, which is an alphanumeric string:\n\n&lt;datum&gt;b9121446-e46c-47c0-9e6d-b4df35c0974b&lt;/datum&gt;\n\nAfter reviewing this datum, please echo is back exactly, without any preamble:\n\n\n\n\nDatum(str(uuid4()))\n\n04da7de4-cc39-4699-9d25-5a476e366732\n\n\nNow we ask the model to “generate” (i.e., echo) 100 of these values.\n\nin_vals = [{\"datum\":str(uuid4())} for _ in range(100)]\nout_vals = fast_data.generate(\n    prompt_template=prompt_template,\n    inputs=in_vals,\n    schema=Datum,\n    sp=sp\n)\n\n100%|█████████████████████████████████████████| 100/100 [00:04&lt;00:00, 24.17it/s]\n\n\nNow we will see if the inputs and outputs are aligned.\nIf they are aligned, then that shows two things. First it shows that the model is echoing the values faithfully. Second, it shows either that the model itself returned outputs in the order in which they were submitted, or else that generate has returned outputs in submission order.\nWe are submitting a large enough quantity of items, that we asssume the model will return some results out of submission order. If you want confidence which does not depend on this assumption, then could modify the test above to increase the number and complexity of the generation task, or simply inspect the implementation.\nLet’s start by spot checking the first item:\n\nin_list = [x['datum'] for x in in_vals]\nout_list = [x.datum for x in out_vals]\n(in_list[0],out_list[0])\n\n('f42ea0db-24ce-4e09-a50d-edf74d0eb611',\n 'f42ea0db-24ce-4e09-a50d-edf74d0eb611')\n\n\n\nfor (idx,(in_item,out_item)) in enumerate(zip(in_list,out_list)):\n    if in_item != out_item:\n        print(\"Failure: output items were not aligned with input items!\")\n        print(f\"\\titem {idx} had in={in_item} and out={out_item}\")\n        break\nelse:\n    print(\"Success: output items are aligned with input items\")\n\nSuccess: output items are aligned with input items",
    "crumbs": [
      "core"
    ]
  }
]